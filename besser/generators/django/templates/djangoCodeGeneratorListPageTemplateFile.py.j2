{%- for component in screen.view_elements %}
        {%- if component is is_List%}
            {%- for source in component.list_sources%}
                {%- if source is is_ModelElement%}
                    {%- set source_name= source.dataSourceClass%}
                    {% set data_source_name_lower = source.dataSourceClass.name[0].lower() + source.dataSourceClass.name[1:]%}
                    {% set data_source_name_upper = source.dataSourceClass.name[0].upper() + source.dataSourceClass.name[1:]%}
{% raw %}{% extends '{% endraw %}{{source.dataSourceClass.name[0].lower() + source.dataSourceClass.name[1:]}}.html' %}

{% raw %}{% block content %}{% endraw %}
<div class="container mx-auto mt-10">
    
    <!-- Back to Home Button -->
    <div class="mb-6">
        <a href="{% raw %}{% url '{% endraw %}home' %}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
            Back to Home Page
        </a>
    </div>
    <h1 class="text-4xl font-extrabold text-gray-900 mb-8">List of {{data_source_name_upper}}s</h1>

    <button id="add{{data_source_name_upper}}Btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg mb-6">
        Add {{data_source_name_upper}}
    </button>

    <div id="add{{data_source_name_upper}}Modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex justify-center items-center">
        <div class="bg-white rounded-lg overflow-hidden shadow-xl w-full max-w-lg">
            <div class="px-6 py-4">
                <h2 class="text-xl font-bold mb-4">Add {{data_source_name_upper}}</h2>
                <form id="{{data_source_name_lower}}Form" action="{% raw %}{% url '{% endraw %}create_{{source.dataSourceClass.name[0].lower() + source.dataSourceClass.name[1:]}}' %}" method="POST">
                    {% raw %}{% csrf_token %}{% endraw %} 
{%- for component in screen.view_elements %}
    {%- if component is is_List%}
        {%- for source in component.list_sources%}
            {%- if source is is_ModelElement%}
                {%- set source_name= source.dataSourceClass%}
                {%- set fieldsList = source.fields|list %}
                    {%- for field in fieldsList%}

                    <div class="form-group">      
                        <label for="{% raw %}{{{% endraw %} form.{{ field.name }}.id_for_label }}" class="block text-gray-700 font-semibold mb-2">{{ field.name[0].upper() + field.name[1:] }}</label>
                        {% raw %}{{{% endraw %} form.{{ field.name }} }}
                    </div> 
                    {%- endfor %}    
            {%- endif %}
        {%- endfor %}     
    {%- endif %}
{%- endfor %}   

    {%- for class_obj in model.classes_sorted_by_inheritance() %}
    {#- start of extract fk_list #} 
     {%-set fk_list = []%}
    {%- for screen in screens %}
        {%- for component in screen.view_elements %}
            {%- if component is is_List%}
                {%- for source in component.list_sources%}
                    {%- if source is is_ModelElement%}
                        {%- set source_name= source.dataSourceClass%}
                            {%- if class_obj.name == source.dataSourceClass.name[0].upper() + source.dataSourceClass.name[1:] %}
                            {%- set generals = namespace(names=[]) %}
                                {%- for parent in class_obj.parents() %}
                                 {%- set _ = generals.names.append(parent.name) %}
                                {%- endfor %}
                                 {%- set inheritance = generals.names | join(', ') %}
                                    {%- for association in class_obj.associations %}
                                        {%- if association.ends|length == 2 and association.name not in processed_associations %}
                                        {%- set ns = namespace(end1=None, end2=None) %}
                                            {%- for end in association.ends %}
                                             {%- set ns.end1=end if end.type.name == class_obj.name else ns.end1 %}
                                             {%- set ns.end2=end if end.type.name != class_obj.name else ns.end2 %}
                                            {%- endfor %}
                                              {%- set class1_name = ns.end1.type.name %}
                                              {%- set class2_name = ns.end2.type.name %}
                                            {%- if ns.end1.multiplicity.max > 1 and ns.end2.multiplicity.max == 1 %}
                                               {%- set _ = fk_list.append(ns.end2.name.replace(' ', '_')) %}
                                            {%- elif ns.end1.multiplicity.max > 1 and ns.end2.multiplicity.max > 1 %}
                                            {%- elif ns.end1.multiplicity.max == 1 and ns.end2.multiplicity.max == 1 %}
                                            {%- set _ = fk_list.append(ns.end2.name.replace(' ', '_')) %}
                                            {%- endif %}
                                        {%- endif %}
                                    {%- endfor %}
                            {%- endif %}
                    {%- endif %} 
                {%-  endfor %}
            {%-  endif %}
        {%-  endfor %}
    {%-  endfor %}


    {#- end of extract fk_list #} 
    {%- if class_obj.name == source.dataSourceClass.name[0].upper() + source.dataSourceClass.name[1:] %}
        {%- set generals = namespace(names=[]) %}
            {%- for parent in class_obj.parents() %}
              {%- set _ = generals.names.append(parent.name) %}
            {%- endfor %}
                {%- set inheritance = generals.names | join(', ') %}
                {%- for association in class_obj.associations %}
                    {%- if association.ends|length == 2 and association.name not in processed_associations %}
                      {%- set ns = namespace(end1=None, end2=None) %}
                        {%- for end in association.ends %}
                           {%- set ns.end1=end if end.type.name == class_obj.name else ns.end1 %}
                           {%- set ns.end2=end if end.type.name != class_obj.name else ns.end2 %}
                        {%- endfor %}
                          {%- set class1_name = ns.end1.type.name %}
                          {%- set class2_name = ns.end2.type.name %}
                            {%- if ns.end1.multiplicity.max > 1 and ns.end2.multiplicity.max > 1 %} 
                            {%- if fk_list|length == 1%}

                    <div class="form-group">      
                        <label for="{% raw %}{{{% endraw %} form.{{ ns.end2.name.replace(' ', '_') }}.id_for_label }}" class="block text-gray-700 font-semibold mb-2">{{class2_name}}</label>
                        {% raw %}{{{% endraw %} form.{{ ns.end2.name.replace(' ', '_') }} }}
                    </div>  
                            {%- else %}
                            {%- endif %}       
                               {%- elif ns.end1.multiplicity.max > 1 and ns.end2.multiplicity.max == 1 %} 
                        
                    <div class="form-group">      
                        <label for="{% raw %}{{{% endraw %} form.{{ ns.end2.name.replace(' ', '_') }}.id_for_label }}" class="block text-gray-700 font-semibold mb-2">{{class2_name}}</label>
                        {% raw %}{{{% endraw %} form.{{ ns.end2.name.replace(' ', '_') }} }}
                    </div> 
                               {%- elif ns.end1.multiplicity.max == 1 and ns.end2.multiplicity.max == 1 %}
                            {%- endif %}
                    {%- endif %}
                {%- endfor %}
    {%- endif %}
{%- endfor %}

                    <div class="flex justify-between mt-6">
                        <button type="button" class="cancelButton bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                            Cancel
                        </button>
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <table class="min-w-full bg-white shadow-md rounded-lg overflow-hidden">
        <thead class="bg-gray-800 text-white">
            <tr>
    {%- for component in screen.view_elements %}
        {%- if component is is_List%}
            {%- for source in component.list_sources%}
                {%- if source is is_ModelElement%}
                   {%- set source_name= source.dataSourceClass%}
                   {%- set fieldsList = source.fields|list %}
                       {%- for field in fieldsList%}
                <th class="w-1/3 text-left py-3 px-4 uppercase font-semibold text-sm">{{ field.name[0].upper() + field.name[1:] }}</th>
                       {%- endfor %}    
                {%- endif %}
            {%- endfor %}     
        {%- endif %}
    {%- endfor %}
                <th class="text-left py-3 px-4 uppercase font-semibold text-sm">Actions</th>
            </tr>
        </thead>
        <tbody class="text-gray-700">
            {% raw %}{% for{% endraw %} {{data_source_name_lower}} in {{data_source_name_lower}}s %}
            <tr>
    {%- for component in screen.view_elements %}
        {%- if component is is_List%}
            {%- for source in component.list_sources%}
                {%- if source is is_ModelElement%}
                   {%- set source_name= source.dataSourceClass%}
                   {%- set fieldsList = source.fields|list %}
                       {%- for field in fieldsList%}
                <td class="w-1/3 text-left py-3 px-4">{% raw %}{{{% endraw %} {{data_source_name_lower}}.{{field.name}} }}</td>
                       {%- endfor %}    
                {%- endif %}
            {%- endfor %}     
        {%- endif %}
    {%- endfor %}
                <td class="flex gap-5 py-3 px-4">
                    <a href="{% raw %}{% url '{% endraw %}edit_{{source.dataSourceClass.name[0].lower() + source.dataSourceClass.name[1:]}}' {{source.dataSourceClass.name[0].lower() + source.dataSourceClass.name[1:]}}.id %}" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg">
                        Edit
                    </a>
                    <a href="{% raw %}{% url '{% endraw %}delete_{{source.dataSourceClass.name[0].lower() + source.dataSourceClass.name[1:]}}' {{source.dataSourceClass.name[0].lower() + source.dataSourceClass.name[1:]}}.id %}" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">
                        Delete
                    </a>
                </td>
            </tr>
            {% raw %}{% endfor %}{% endraw %}
        </tbody>
    </table>
</div>
{% raw %}{% endblock %}{% endraw %}
            {%-  endif %}
        {%-  endfor %}
    {%-  endif %}
{%-  endfor %}


