services:
  besser-wme-backend:
    image: artefacts.list.lu/besser/web_modeling_editor/backend:latest
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "9000:9000"
    volumes:
      - ./:/app
      - /var/run/docker.sock:/var/run/docker.sock
    working_dir: /app/besser
    environment:
      - PYTHONPATH=/app
      - FEEDBACK_EMAIL=${FEEDBACK_EMAIL}
      - SMTP_HOST=${SMTP_HOST:-smtp.gmail.com}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USERNAME=${SMTP_USERNAME}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
      - GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}
      - GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}
      - GITHUB_REDIRECT_URI=${GITHUB_REDIRECT_URI:-http://localhost:9000/besser_api/github/auth/callback}
    command: python -m besser.utilities.web_modeling_editor.backend.backend
    networks:
      - besser_network

  besser-wme-frontend:
    image: artefacts.list.lu/besser/web_modeling_editor/frontend:latest
    build:
      context: ./besser/utilities/web_modeling_editor/frontend
      dockerfile: Dockerfile
    container_name: besser-wme-frontend
    environment:
      - DEPLOYMENT_URL=${DEPLOYMENT_URL}
      - BACKEND_URL=${BACKEND_URL}
      - UML_BOT_WS_URL=${UML_BOT_WS_URL}
      - POSTHOG_KEY=${POSTHOG_KEY}
      - POSTHOG_HOST=${POSTHOG_HOST}
    restart: always
    networks:
      - besser_network
    ports:
      - "8080:8080"

  # besser-wme-modeling-agent:
  #   image: artefacts.list.lu/besser/web_modeling_editor/modeling_agent:latest
  #   build:
  #     context: ./besser/utilities/web_modeling_editor/frontend/ModelingAgent
  #     dockerfile: Dockerfile
  #   container_name: besser-wme-modeling-agent
  #   environment:
  #     - OPENAI_API_KEY=${OPENAI_API_KEY}
  #     - PYTHONUNBUFFERED=1
  #   ports:
  #     - "8765:8765"
  #   restart: unless-stopped
  #   networks:
  #     - besser_network
  #   depends_on:
  #     - besser_redis

volumes: {}

networks:
  besser_network:
    name: besser_network
    driver: bridge